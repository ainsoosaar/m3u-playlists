name: Update Ontivi Playlist
on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  update-playlist:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm install puppeteer
      
    - name: Run playlist builder
      run: node scripts/build_playlist.js
      
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GH_PAT }}
        commit-message: "Auto update Ontivi IPTV playlist"
        title: "Auto-update: Ontivi IPTV playlist"
        body: |
          Automated playlist update from GitHub Actions
          
          - Updated: $(date '+%Y-%m-%d %H:%M')
          - Source: Ontivi IPTV
        branch: auto-update-playlist
        base: main
